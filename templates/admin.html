{% extends "base.html" %}

{% block title %}CZDS Admin Panel{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-slate-900 mb-6">ICANN CZDS Admin Panel</h1>
    
    <!-- Authentication Section -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
        <h2 class="text-2xl font-bold text-slate-900 mb-4">Authentication</h2>
        
        {% if token_info and token_info.get("isValid", False) %}
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-800 font-medium">✓ Authenticated</p>
                    <p class="text-sm text-green-600 mt-1">
                        Token expires: {{ token_info.get("expiresAt", "N/A") }}
                    </p>
                </div>
                <button id="refresh-token" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                    Refresh Token
                </button>
            </div>
        </div>
        {% else %}
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
            <p class="text-yellow-800">⚠ Not authenticated. Please authenticate to access CZDS API.</p>
        </div>
        {% endif %}
        
        <form id="auth-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">CZDS Username (Email)</label>
                    <input type="email" id="username" name="username" required
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent"
                        placeholder="your.email@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">CZDS Password</label>
                    <input type="password" id="password" name="password" required
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent"
                        placeholder="••••••••">
                </div>
            </div>
            <button type="submit" class="w-full md:w-auto px-6 py-2 bg-slate-900 text-white rounded-lg font-medium hover:bg-slate-800 transition">
                Authenticate
            </button>
        </form>
    </div>
    
    <!-- Zones Section -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-6" id="zones-section">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-slate-900">Authorized Zones</h2>
            <button id="refresh-zones" class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200">
                Refresh List
            </button>
        </div>
        
        {% if zones_error %}
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
            <p class="text-red-800">Error: {{ zones_error }}</p>
        </div>
        {% endif %}
        
        {% if zones %}
        <div class="mb-4">
            <p class="text-slate-600">Found <strong>{{ zones_count }}</strong> authorized zone files</p>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="bg-slate-50 border-b border-slate-200">
                        <th class="text-left py-3 px-4 text-slate-700 font-medium">Zone URL</th>
                        <th class="text-left py-3 px-4 text-slate-700 font-medium">TLD</th>
                        <th class="text-left py-3 px-4 text-slate-700 font-medium">Actions</th>
                    </tr>
                </thead>
                <tbody id="zones-body">
                    {% for zone_url in zones %}
                    <tr class="border-b border-slate-100 hover:bg-slate-50">
                        <td class="py-3 px-4 font-mono text-sm text-slate-900">{{ zone_url }}</td>
                        <td class="py-3 px-4 text-slate-600">
                            {% set tld = zone_url.split('/')[-1].replace('.zone', '') %}
                            .{{ tld }}
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex gap-2">
                                <button class="zone-info-btn px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm hover:bg-blue-200" 
                                    data-url="{{ zone_url }}">
                                    Info
                                </button>
                                <button class="zone-download-btn px-3 py-1 bg-green-100 text-green-800 rounded text-sm hover:bg-green-200"
                                    data-url="{{ zone_url }}" data-tld="{{ zone_url.split('/')[-1].replace('.zone', '') }}">
                                    Download
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-8 text-slate-500" id="zones-empty">
            No zones found. Please authenticate and click "Refresh List" to load zones.
        </div>
        {% endif %}
    </div>
    
    <!-- Download Status -->
    <div id="download-status" class="hidden bg-white rounded-2xl shadow-sm p-6 mb-6">
        <h3 class="text-xl font-bold text-slate-900 mb-4">Download & Process Status</h3>
        <div id="download-messages" class="space-y-2"></div>
    </div>
    
    <!-- Quick Actions -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
        <h2 class="text-2xl font-bold text-slate-900 mb-4">Quick Actions</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="/drops" class="px-6 py-3 bg-slate-900 text-white rounded-lg font-medium hover:bg-slate-800 transition text-center">
                View Dropped Domains
            </a>
            <a href="/tlds" class="px-6 py-3 bg-slate-100 text-slate-900 rounded-lg font-medium hover:bg-slate-200 transition text-center">
                View TLDs
            </a>
        </div>
    </div>
</div>

<!-- Zone Info Modal -->
<div id="zone-info-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 max-w-2xl w-full mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold text-slate-900">Zone File Information</h3>
            <button id="close-modal" class="text-slate-500 hover:text-slate-700">✕</button>
        </div>
        <div id="zone-info-content" class="space-y-2"></div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/admin.js"></script>
{% endblock %}

